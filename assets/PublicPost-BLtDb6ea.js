import{r as i,s as Ne,a,b as t,c as I,j as e,L as _e,d as u,E as K,X as U,S as we,T as ve,M as be,e as ke,f as C,R as Ie,m as Ce,y as X,g as Se,h as Pe}from"./index-gF_tL_dL.js";function Re(p){const N=["","K","M","B","T"];let h=0;for(;p>=1e3&&h<N.length-1;)p/=1e3,h++;return p.toFixed(1).replace(/\.0$/,"")+N[h]}const Oe=()=>{const[p,N]=i.useState([]),[h,T]=i.useState(!1),[S,$]=i.useState(0),[o,f]=i.useState(""),[E,j]=i.useState(!1),[_,y]=i.useState(""),[A,g]=i.useState(!1),[P,R]=i.useState(""),[x,H]=i.useState([]),[J,Q]=i.useState([{text:"hello",user:"67d7a8c65a7e8be20ce47cbc",_id:"67dc0b2c1f5cee2eaa24d9aa",replies:[]}]),[n,V]=i.useState(""),[Y,W]=i.useState(""),[B,F]=i.useState(""),[Z,L]=i.useState(!1),[ee,se]=i.useState(null),te=async()=>{try{const s=await a.get(Ce,{withCredentials:!0});se(s.data.data)}catch(s){console.log(s)}},w=(s,r)=>{a.post(t+"/api/addNoti/add",{receiverId:x.postOwner,senderId:localStorage.getItem("myId"),type:"comment",commentId:s,text:r,postId:null}),I.emit("__load_data__")};Ne(p.length);const v=s=>{X.success(s)},[re,ie]=i.useState("");i.useEffect(()=>{const s=localStorage.getItem("myId");te();try{(async()=>{const c=await a.get(t+"/api/post/publicpost/"+s,{withCredentials:!0});N(c.data.posts);const l=await a.get(t+"/api/people/userStyle",{withCredentials:!0});ie(l.data.data.styles.postbg)})()}catch(r){console.log(r)}},[S]);const O=async s=>{console.log("working....!");try{const r=await a.get(t+`/api/post/postinfo/${s}`);H(r.data.singlePost),Q(r.data.singlePost.comments)}catch(r){console.log(r)}};i.useEffect(()=>(O(n),I.on("__load_data__",s=>{O(n)}),()=>{I.off("__load_data__")}),[n]);const le=s=>{a.post(t+"/api/post/addlike",{postId:s},{withCredentials:!0})},ae=()=>{o.trim()&&(a.post(t+"/api/post/addcomment",{comment:o,post_id:n},{withCredentials:!0}),f(""),v("comment added ☺"),w(n,o))},ne=()=>{o.trim()&&(a.post(t+"/api/post/addreplay",{replyText:o,postId:n,commentId:_},{withCredentials:!0}),w(n,o)),f(""),v("replay added ☺")},oe=()=>{o.trim()&&a.post(t+"/api/post/addinnerreplay",{replyText:o,postId:n,commentId:_,repId:P},{withCredentials:!0}),f(""),v("replay added ☺"),g(!1),w(P,o)},de=()=>{o.trim()&&a.post(t+"/api/post/addNestedInnerReplay",{replyText:o,postId:n,commentId:_,repId:P,replayOf:Y,nestedId:B},{withCredentials:!0}),f(""),v("replay added ☺"),g(!1),w(B,o)},ce=()=>{a.post(t+"/api/post/addlike_comment",{postId:n,commentId:_},{withCredentials:!0})},me=(s,r)=>{a.post(t+"/api/post/addlike_replay",{postId:n,commentId:r,repId:s},{withCredentials:!0}),console.log("commentId",r,"repId",s,"postId",n)},pe=(s,r,c)=>{a.post(t+"/api/post/inner_addlike_replay",{postId:n,commentId:r,repId:s,nestId:c},{withCredentials:!0})},M=i.useRef(),b=()=>{M.current.focus()},xe=s=>{a.post(t+"/api/people/remove_post",{postId:s},{withCredentials:!0}),$(S+1)},z=s=>{const r=localStorage.getItem("myId");a.post(t+"/api/save/save",{id:s,_id_:r})},[ue,he]=i.useState(!1),[G,fe]=i.useState(""),je=()=>{ue&&X(()=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("h6",{className:"italic flex justify-start items-center gap-2 cursor-pointer",onClick:()=>{z(G)},children:[e.jsx(Se,{})," save this"]}),e.jsxs("h6",{className:"italic flex justify-start items-center gap-2 cursor-pointer",onClick:()=>{z(G)},children:[e.jsx(Pe,{})," copy link this"]})]}))};return e.jsxs("div",{className:"sm:p-4 h-auto",id:"postInnerContainer",children:[e.jsx(_e,{}),p.map((s,r)=>{var c,l,k;return e.jsxs("div",{className:`mx-auto w-full  rounded-lg border p-2 backdrop-blur-md my-5 ${re} ${s.video?"h-[600px]":"h-auto"}`,children:[e.jsxs("div",{className:"flex justify-between items-center border-b-2 border-cyan-700 mb-3",children:[e.jsxs(u,{to:"/publicprofile",state:{id:(c=s==null?void 0:s.postOwner)==null?void 0:c._id},className:"flex items-center gap-3",title:"profile",children:[e.jsx("img",{className:"w-10 h-10 rounded-full",src:t+((l=s==null?void 0:s.postOwner)==null?void 0:l.image)}),e.jsx("h4",{className:"hover:text-blue-600 duration-200",children:(k=s==null?void 0:s.postOwner)==null?void 0:k.name})]}),e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("span",{onClick:()=>{he(!0),fe(s._id),je()},children:e.jsx(K,{size:48,strokeWidth:1.5,absoluteStrokeWidth:!0})}),e.jsx("span",{onClick:()=>{xe(s._id)},className:"hover:text-red-500",children:e.jsx(U,{})})]})]}),e.jsx("div",{className:"my-2",children:e.jsx(we,{text:s.caption,range:200})}),s.image&&!s.video?e.jsx("img",{className:"rounded-md w-full max-h-96 object-fill",src:t+s.media}):e.jsx("video",{src:t+s.media,controls:!0,loop:!0,className:"h-[450px] w-full object-fill"}),e.jsxs("footer",{className:"flex w-full justify-between items-end border-t h-10",children:[e.jsxs("span",{onClick:()=>{le(s._id),$(S+1)},className:"post_footer w-4/12 border-e",children:[e.jsx(ve,{}),e.jsx("span",{children:"Like"}),e.jsx("span",{children:s.likes.length})]}),e.jsxs("span",{className:"post_footer w-4/12 border-e justify-center",onClick:()=>{T(!0),V(s._id)},children:[e.jsx(be,{}),e.jsxs("span",{children:["comments ",Re(s.comments.length)]})]}),e.jsxs("span",{className:"post_footer w-4/12  justify-end",children:[e.jsx(ke,{}),e.jsx(u,{to:"/share",state:{friends:ee,post:s._id},children:"share"})]})]})]},r)}),e.jsx("div",{className:`w-full h-full backdrop-blur-sm fixed top-0 left-0 flex justify-center items-center ${h?"":"hidden"} z-50`,id:"commentplate",children:e.jsxs("div",{className:"w-full sm:w-8/12 rounded-md bg-teal-950 h-full sm:h-[92vh] shadow-xl p-2",children:[e.jsxs("header",{className:"flex justify-end items-center gap-3 border-b pb-1 mb-1",children:[e.jsx("span",{children:e.jsx(K,{})}),e.jsx("span",{onClick:()=>{T(!1)},children:e.jsx(U,{})})]}),e.jsxs("div",{className:"w-full h-[82vh] sm:h-[75vh] overflow-y-auto",children:[e.jsxs("div",{className:"w-full h-auto rounded-lg bg-gray-700",children:[x.image&&!x.video?e.jsx("img",{className:"rounded-md w-full max-h-96 object-contain",src:t+x.media}):e.jsx("video",{src:t+x.media,controls:!0,loop:!0}),e.jsx("p",{className:"p-2 text-teal-300",children:x.caption})]}),e.jsx("div",{className:"w-full h-auto mt-2 rounded-md",children:J.map((s,r)=>{var c;return e.jsxs("div",{className:"my-2 bg-gray-700 rounded-md p-2 border-b-4 text-sm ",children:[e.jsxs("div",{className:"border-s border-b w-full p-1 sm:p-2 rounded-sm",children:[e.jsxs("div",{className:"flex justify-start items-center gap-1",children:[e.jsxs("div",{className:"flex justify-start items-center gap-1 cursor-pointer",children:[e.jsx("img",{src:t+s.user.image,className:"w-6 h-6 rounded-full"}),e.jsx(u,{to:"/publicprofile",state:{id:s.user._id},className:`text-sm text-ellipsis font-extrabold text-sky-600 duration-200\r
                        hover:text-cyan-500`,children:e.jsx(C,{text:s.user.name,width:window.innerWidth,dot:3})})]}),e.jsx("span",{children:"|"}),e.jsxs("span",{className:`cursor-pointer text-indigo-600 duration-200\r
                hover:text-indigo-400`,onClick:()=>{y(s._id),ce()},children:["like ",(c=s.likes)==null?void 0:c.length]}),e.jsx("span",{children:"|"}),e.jsx("span",{className:"cursor-pointer text-green-500 duration-200 hover:text-green-300",onClick:()=>{y(s._id),j(!0),b()},children:"replay"}),e.jsx("span",{children:"|"}),e.jsx("span",{className:`text-orange-600 duration-200\r
                hover:text-orange-500 cursor-pointer`,onClick:()=>{document.getElementById(`replayPlate${r}`).style.display="block"},children:e.jsx(C,{text:"view replay",width:window.innerWidth,dot:2})})]}),e.jsx("h5",{className:"ml-6 mt-1",children:s.text})]}),e.jsx("div",{className:"ml-1 mt-0 hidden",id:`replayPlate${r}`,children:s.replies.map((l,k)=>{var q;return e.jsxs("div",{className:"my-1",children:[e.jsxs("div",{className:"p-1 sm:p-2 border-s border-b w-full rounded-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(u,{to:"/publicprofile",state:{id:l.user._id},className:"flex justify-start items-center gap-1 cursor-pointer",children:[e.jsx("img",{src:t+l.user.image,className:"w-6 h-6 rounded-full"}),e.jsx("h5",{className:`text-sm text-ellipsis font-extrabold\r
                                 text-pink-600 duration-200\r
                            hover:text-pink-400`,children:e.jsx(C,{text:l.user.name,width:window.innerWidth,dot:3,range:8})})]}),e.jsx("span",{children:"|"}),e.jsxs("span",{className:`cursor-pointer\r
                     text-blue duration-200\r
                    hover:text-indigo-600`,onClick:()=>{me(l._id,s._id)},children:["like ",(q=l.likes)==null?void 0:q.length]}),e.jsx("span",{children:"|"}),e.jsx("span",{className:`cursor-pointer text-lime-500 \r
                    duration-200 hover:text-lime-300`,onClick:()=>{g(!0),L(!1),R(l._id),y(s._id),j(!0),b()},children:"replay"})]}),e.jsx("h5",{className:"ml-6 mt-1",children:l.text})]}),e.jsx("div",{children:l.replay.map((d,ye)=>{var D;return e.jsxs("div",{className:"border-s border-b ml-1 sm:ml-8 p-2 rounded-sm",children:[e.jsxs("div",{className:"flex justify-start items-center gap-1 cursor-pointer",children:[e.jsxs(u,{to:"/publicprofile",state:{id:d.user._id},className:"flex justify-start items-center gap-1",children:[e.jsx("img",{src:t+d.user.image,className:"w-6 h-6 rounded-full"}),e.jsx("h5",{className:`text-sm text-ellipsis font-extrabold\r
                                                        text-pink-600 duration-200\r
                                                    hover:text-pink-400`,children:e.jsx(C,{text:d.user.name,range:8,dot:3,width:window.innerWidth})})]}),e.jsx("span",{children:"|"}),e.jsxs("span",{className:`cursor-pointer\r
                                                                text-blue duration-200\r
                                                                hover:text-indigo-600`,onClick:()=>{pe(l._id,s._id,d._id)},children:["like ",(D=d.likes)==null?void 0:D.length]}),e.jsx("span",{children:"|"}),e.jsx("span",{className:`cursor-pointer text-lime-500 \r
                                                                        duration-200 hover:text-lime-300`,onClick:()=>{g(!1),L(!0),F(d._id),W(d.text),y(s._id),R(l._id),j(!0),b()},children:"replay"})]}),e.jsx("h5",{className:"ml-6 mt-1",children:d.text}),e.jsx("div",{className:"",children:d.replay.map((m,ge)=>e.jsxs("div",{className:"p-0 ",children:[e.jsx("hr",{}),e.jsxs("div",{className:"sm:ml-6 mt-1 flex flex-wrap justify-start items-center ",children:[e.jsx("span",{className:"italic text-sky-500 pr-2",children:"reply of"}),e.jsxs("span",{className:"",children:["[",m.replayOf,"]"]}),e.jsxs(u,{to:"/publicprofile",state:{id:m.user._id},className:"flex items-center px-2 cursor-pointer hover:underline hover:text-sky-500",children:[e.jsx("img",{className:"w-4 h-4 rounded-full",src:t+m.user.image}),e.jsx("span",{className:"px-1 text-xs",children:m.user.name})]}),e.jsx("span",{className:"px-1 text-orange-400",children:m.user.gender==="male"?"his reply is:-":"shis reply is:-"}),e.jsx("span",{className:"underline animate-pulse",children:m.text}),e.jsx("span",{className:`cursor-pointer text-lime-500 px-2\r
                                                                            duration-200 hover:text-lime-300`,onClick:()=>{g(!1),L(!0),F(d._id),W(m.text),y(s._id),R(l._id),j(!0),b()},children:"replay"})]})]},ge))})]},ye)})})]},k)})})]},r)})})]}),e.jsxs("div",{className:"flex justify-between items-center gap-1",children:[e.jsx("input",{type:"text",placeholder:`write ${E?"replay":"comment"} text`,className:"w-11/12 rounded-e-none p-1 placeholder:text-sm text-white",onChange:s=>{f(s.target.value)},value:o,ref:M}),e.jsx("div",{className:`border-none pr-3 rounded-s-none \r
                            h-auto w-16 bg-gradient-to-r from-fuchsia-500\r
                         to-cyan-500 flex justify-center items-center p-1 \r
                            rounded-e-lg text-white cursor-pointer`,onClick:()=>{A?oe():Z?de():E?ne():ae(),setTimeout(()=>{j(!1)},60),O(n),I.emit("__load_data__")},children:e.jsx(Ie,{})})]})]})})]})};export{Oe as default};
