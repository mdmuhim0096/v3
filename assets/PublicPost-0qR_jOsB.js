import{r,s as ve,a as o,b as I,j as e,L as Ne,c as u,d as c,E as K,X as U,S as _e,T as we,M as be,e as ke,f as C,R as Ie,m as Ce,y as X,g as Se,h as Pe}from"./index-Bli28Js5.js";function Re(p){const v=["","K","M","B","T"];let h=0;for(;p>=1e3&&h<v.length-1;)p/=1e3,h++;return p.toFixed(1).replace(/\.0$/,"")+v[h]}const Oe=()=>{const[p,v]=r.useState([]),[h,T]=r.useState(!1),[S,$]=r.useState(0),[l,f]=r.useState(""),[E,j]=r.useState(!1),[N,y]=r.useState(""),[A,g]=r.useState(!1),[P,R]=r.useState(""),[x,H]=r.useState([]),[J,Q]=r.useState([{text:"hello",user:"67d7a8c65a7e8be20ce47cbc",_id:"67dc0b2c1f5cee2eaa24d9aa",replies:[]}]),[i,V]=r.useState(""),[Y,W]=r.useState(""),[B,F]=r.useState(""),[Z,L]=r.useState(!1),[ee,se]=r.useState(null),te=async()=>{try{const s=await o.get(Ce,{withCredentials:!0});se(s.data.data)}catch(s){console.log(s)}},_=(s,t)=>{o.post("https://node-v1-tc13.onrender.com/api/addNoti/add",{receiverId:x.postOwner,senderId:localStorage.getItem("myId"),type:"comment",commentId:s,text:t,postId:null}),I.emit("__load_data__")};ve(p.length);const w=s=>{X.success(s)},[re,ne]=r.useState("");r.useEffect(()=>{const s=localStorage.getItem("myId");te();try{(async()=>{const d=await o.get("https://node-v1-tc13.onrender.com/api/post/publicpost/"+s,{withCredentials:!0});v(d.data.posts);const n=await o.get("https://node-v1-tc13.onrender.com/api/people/userStyle",{withCredentials:!0});ne(n.data.data.styles.postbg)})()}catch(t){console.log(t)}},[S]);const O=async s=>{console.log("working....!");try{const t=await o.get(`https://node-v1-tc13.onrender.com/api/post/postinfo/${s}`);H(t.data.singlePost),Q(t.data.singlePost.comments)}catch(t){console.log(t)}};r.useEffect(()=>(O(i),I.on("__load_data__",s=>{O(i)}),()=>{I.off("__load_data__")}),[i]);const oe=s=>{o.post("https://node-v1-tc13.onrender.com/api/post/addlike",{postId:s},{withCredentials:!0})},ie=()=>{l.trim()&&(o.post("https://node-v1-tc13.onrender.com/api/post/addcomment",{comment:l,post_id:i},{withCredentials:!0}),f(""),w("comment added ☺"),_(i,l))},le=()=>{l.trim()&&(o.post("https://node-v1-tc13.onrender.com/api/post/addreplay",{replyText:l,postId:i,commentId:N},{withCredentials:!0}),_(i,l)),f(""),w("replay added ☺")},ae=()=>{l.trim()&&o.post("https://node-v1-tc13.onrender.com/api/post/addinnerreplay",{replyText:l,postId:i,commentId:N,repId:P},{withCredentials:!0}),f(""),w("replay added ☺"),g(!1),_(P,l)},de=()=>{l.trim()&&o.post("https://node-v1-tc13.onrender.com/api/post/addNestedInnerReplay",{replyText:l,postId:i,commentId:N,repId:P,replayOf:Y,nestedId:B},{withCredentials:!0}),f(""),w("replay added ☺"),g(!1),_(B,l)},ce=()=>{o.post("https://node-v1-tc13.onrender.com/api/post/addlike_comment",{postId:i,commentId:N},{withCredentials:!0})},me=(s,t)=>{o.post("https://node-v1-tc13.onrender.com/api/post/addlike_replay",{postId:i,commentId:t,repId:s},{withCredentials:!0}),console.log("commentId",t,"repId",s,"postId",i)},pe=(s,t,d)=>{o.post("https://node-v1-tc13.onrender.com/api/post/inner_addlike_replay",{postId:i,commentId:t,repId:s,nestId:d},{withCredentials:!0})},M=r.useRef(),b=()=>{M.current.focus()},xe=s=>{o.post("https://node-v1-tc13.onrender.com/api/people/remove_post",{postId:s},{withCredentials:!0}),$(S+1)},z=s=>{const t=localStorage.getItem("myId");o.post("https://node-v1-tc13.onrender.com/api/save/save",{id:s,_id_:t})},[ue,he]=r.useState(!1),[G,fe]=r.useState(""),je=()=>{ue&&X(()=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("h6",{className:"italic flex justify-start items-center gap-2 cursor-pointer",onClick:()=>{z(G)},children:[e.jsx(Se,{})," save this"]}),e.jsxs("h6",{className:"italic flex justify-start items-center gap-2 cursor-pointer",onClick:()=>{z(G)},children:[e.jsx(Pe,{})," copy link this"]})]}))};return e.jsxs("div",{className:"sm:p-4 h-auto",id:"postInnerContainer",children:[e.jsx(Ne,{}),p.map((s,t)=>{var d,n,k;return e.jsxs("div",{className:`mx-auto w-full  rounded-lg border p-2 backdrop-blur-md my-5 ${re} ${s.video?"h-[600px]":"h-auto"}`,children:[e.jsxs("div",{className:"flex justify-between items-center border-b-2 border-cyan-700 mb-3",children:[e.jsxs(u,{to:"/publicprofile",state:{id:(d=s==null?void 0:s.postOwner)==null?void 0:d._id},className:"flex items-center gap-3",title:"profile",children:[e.jsx("img",{className:"w-10 h-10 rounded-full",src:c+((n=s==null?void 0:s.postOwner)==null?void 0:n.image)}),e.jsx("h4",{className:"hover:text-blue-600 duration-200",children:(k=s==null?void 0:s.postOwner)==null?void 0:k.name})]}),e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("span",{onClick:()=>{he(!0),fe(s._id),je()},children:e.jsx(K,{size:48,strokeWidth:1.5,absoluteStrokeWidth:!0})}),e.jsx("span",{onClick:()=>{xe(s._id)},className:"hover:text-red-500",children:e.jsx(U,{})})]})]}),e.jsx("div",{className:"my-2",children:e.jsx(_e,{text:s.caption,range:200})}),s.image&&!s.video?e.jsx("img",{className:"rounded-md w-full max-h-96 object-fill",src:c+s.media}):e.jsx("video",{src:c+s.media,controls:!0,loop:!0,className:"h-[450px] w-full object-fill"}),e.jsxs("footer",{className:"flex w-full justify-between items-end border-t h-10",children:[e.jsxs("span",{onClick:()=>{oe(s._id),$(S+1)},className:"post_footer w-4/12 border-e",children:[e.jsx(we,{}),e.jsx("span",{children:"Like"}),e.jsx("span",{children:s.likes.length})]}),e.jsxs("span",{className:"post_footer w-4/12 border-e justify-center",onClick:()=>{T(!0),V(s._id)},children:[e.jsx(be,{}),e.jsxs("span",{children:["comments ",Re(s.comments.length)]})]}),e.jsxs("span",{className:"post_footer w-4/12  justify-end",children:[e.jsx(ke,{}),e.jsx(u,{to:"/share",state:{friends:ee,post:s._id},children:"share"})]})]})]},t)}),e.jsx("div",{className:`w-full h-full backdrop-blur-sm fixed top-0 left-0 flex justify-center items-center ${h?"":"hidden"} z-50`,id:"commentplate",children:e.jsxs("div",{className:"w-full sm:w-8/12 rounded-md bg-teal-950 h-full sm:h-[92vh] shadow-xl p-2",children:[e.jsxs("header",{className:"flex justify-end items-center gap-3 border-b pb-1 mb-1",children:[e.jsx("span",{children:e.jsx(K,{})}),e.jsx("span",{onClick:()=>{T(!1)},children:e.jsx(U,{})})]}),e.jsxs("div",{className:"w-full h-[82vh] sm:h-[75vh] overflow-y-auto",children:[e.jsxs("div",{className:"w-full h-auto rounded-lg bg-gray-700",children:[x.image&&!x.video?e.jsx("img",{className:"rounded-md w-full max-h-96 object-contain",src:c+x.media}):e.jsx("video",{src:c+x.media,controls:!0,loop:!0}),e.jsx("p",{className:"p-2 text-teal-300",children:x.caption})]}),e.jsx("div",{className:"w-full h-auto mt-2 rounded-md",children:J.map((s,t)=>{var d;return e.jsxs("div",{className:"my-2 bg-gray-700 rounded-md p-2 border-b-4 text-sm ",children:[e.jsxs("div",{className:"border-s border-b w-full p-1 sm:p-2 rounded-sm",children:[e.jsxs("div",{className:"flex justify-start items-center gap-1",children:[e.jsxs("div",{className:"flex justify-start items-center gap-1 cursor-pointer",children:[e.jsx("img",{src:c+s.user.image,className:"w-6 h-6 rounded-full"}),e.jsx(u,{to:"/publicprofile",state:{id:s.user._id},className:`text-sm text-ellipsis font-extrabold text-sky-600 duration-200\r
                        hover:text-cyan-500`,children:e.jsx(C,{text:s.user.name,width:window.innerWidth,dot:3})})]}),e.jsx("span",{children:"|"}),e.jsxs("span",{className:`cursor-pointer text-indigo-600 duration-200\r
                hover:text-indigo-400`,onClick:()=>{y(s._id),ce()},children:["like ",(d=s.likes)==null?void 0:d.length]}),e.jsx("span",{children:"|"}),e.jsx("span",{className:"cursor-pointer text-green-500 duration-200 hover:text-green-300",onClick:()=>{y(s._id),j(!0),b()},children:"replay"}),e.jsx("span",{children:"|"}),e.jsx("span",{className:`text-orange-600 duration-200\r
                hover:text-orange-500 cursor-pointer`,onClick:()=>{document.getElementById(`replayPlate${t}`).style.display="block"},children:e.jsx(C,{text:"view replay",width:window.innerWidth,dot:2})})]}),e.jsx("h5",{className:"ml-6 mt-1",children:s.text})]}),e.jsx("div",{className:"ml-1 mt-0 hidden",id:`replayPlate${t}`,children:s.replies.map((n,k)=>{var q;return e.jsxs("div",{className:"my-1",children:[e.jsxs("div",{className:"p-1 sm:p-2 border-s border-b w-full rounded-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(u,{to:"/publicprofile",state:{id:n.user._id},className:"flex justify-start items-center gap-1 cursor-pointer",children:[e.jsx("img",{src:c+n.user.image,className:"w-6 h-6 rounded-full"}),e.jsx("h5",{className:`text-sm text-ellipsis font-extrabold\r
                                 text-pink-600 duration-200\r
                            hover:text-pink-400`,children:e.jsx(C,{text:n.user.name,width:window.innerWidth,dot:3,range:8})})]}),e.jsx("span",{children:"|"}),e.jsxs("span",{className:`cursor-pointer\r
                     text-blue duration-200\r
                    hover:text-indigo-600`,onClick:()=>{me(n._id,s._id)},children:["like ",(q=n.likes)==null?void 0:q.length]}),e.jsx("span",{children:"|"}),e.jsx("span",{className:`cursor-pointer text-lime-500 \r
                    duration-200 hover:text-lime-300`,onClick:()=>{g(!0),L(!1),R(n._id),y(s._id),j(!0),b()},children:"replay"})]}),e.jsx("h5",{className:"ml-6 mt-1",children:n.text})]}),e.jsx("div",{children:n.replay.map((a,ye)=>{var D;return e.jsxs("div",{className:"border-s border-b ml-1 sm:ml-8 p-2 rounded-sm",children:[e.jsxs("div",{className:"flex justify-start items-center gap-1 cursor-pointer",children:[e.jsxs(u,{to:"/publicprofile",state:{id:a.user._id},className:"flex justify-start items-center gap-1",children:[e.jsx("img",{src:c+a.user.image,className:"w-6 h-6 rounded-full"}),e.jsx("h5",{className:`text-sm text-ellipsis font-extrabold\r
                                                        text-pink-600 duration-200\r
                                                    hover:text-pink-400`,children:e.jsx(C,{text:a.user.name,range:8,dot:3,width:window.innerWidth})})]}),e.jsx("span",{children:"|"}),e.jsxs("span",{className:`cursor-pointer\r
                                                                text-blue duration-200\r
                                                                hover:text-indigo-600`,onClick:()=>{pe(n._id,s._id,a._id)},children:["like ",(D=a.likes)==null?void 0:D.length]}),e.jsx("span",{children:"|"}),e.jsx("span",{className:`cursor-pointer text-lime-500 \r
                                                                        duration-200 hover:text-lime-300`,onClick:()=>{g(!1),L(!0),F(a._id),W(a.text),y(s._id),R(n._id),j(!0),b()},children:"replay"})]}),e.jsx("h5",{className:"ml-6 mt-1",children:a.text}),e.jsx("div",{className:"",children:a.replay.map((m,ge)=>e.jsxs("div",{className:"p-0 ",children:[e.jsx("hr",{}),e.jsxs("div",{className:"sm:ml-6 mt-1 flex flex-wrap justify-start items-center ",children:[e.jsx("span",{className:"italic text-sky-500 pr-2",children:"reply of"}),e.jsxs("span",{className:"",children:["[",m.replayOf,"]"]}),e.jsxs(u,{to:"/publicprofile",state:{id:m.user._id},className:"flex items-center px-2 cursor-pointer hover:underline hover:text-sky-500",children:[e.jsx("img",{className:"w-4 h-4 rounded-full",src:c+m.user.image}),e.jsx("span",{className:"px-1 text-xs",children:m.user.name})]}),e.jsx("span",{className:"px-1 text-orange-400",children:m.user.gender==="male"?"his reply is:-":"shis reply is:-"}),e.jsx("span",{className:"underline animate-pulse",children:m.text}),e.jsx("span",{className:`cursor-pointer text-lime-500 px-2\r
                                                                            duration-200 hover:text-lime-300`,onClick:()=>{g(!1),L(!0),F(a._id),W(m.text),y(s._id),R(n._id),j(!0),b()},children:"replay"})]})]},ge))})]},ye)})})]},k)})})]},t)})})]}),e.jsxs("div",{className:"flex justify-between items-center gap-1",children:[e.jsx("input",{type:"text",placeholder:`write ${E?"replay":"comment"} text`,className:"w-11/12 rounded-e-none p-1 placeholder:text-sm text-white",onChange:s=>{f(s.target.value)},value:l,ref:M}),e.jsx("div",{className:`border-none pr-3 rounded-s-none \r
                            h-auto w-16 bg-gradient-to-r from-fuchsia-500\r
                         to-cyan-500 flex justify-center items-center p-1 \r
                            rounded-e-lg text-white cursor-pointer`,onClick:()=>{A?ae():Z?de():E?le():ie(),setTimeout(()=>{j(!1)},60),O(i),I.emit("__load_data__")},children:e.jsx(Ie,{})})]})]})})]})};export{Oe as default};
